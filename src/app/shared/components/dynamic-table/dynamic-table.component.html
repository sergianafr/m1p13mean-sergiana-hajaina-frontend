<div class="dynamic-table-container">
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Chargement...</p>
    </div>
  } @else {
    @if (data().length === 0) {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <p>{{ emptyMessage() }}</p>
      </div>
    } @else {
      <div class="table-wrapper">
        <table 
          mat-table 
          [dataSource]="data()" 
          matSort 
          (matSortChange)="handleSortChange($event)"
          class="dynamic-table">
          
          @for (column of visibleColumns(); track column.key) {
            <ng-container [matColumnDef]="column.key">
              <th 
                mat-header-cell 
                *matHeaderCellDef 
                [mat-sort-header]="column.sortable ? column.key : ''"
                [disabled]="!column.sortable"
                [style.width]="column.width"
                [style.text-align]="getAlignment(column)">
                {{ column.label }}
              </th>
              <td 
                mat-cell 
                *matCellDef="let row" 
                [class]="getCellClass(row, column)"
                [style.text-align]="getAlignment(column)">
                {{ getCellValue(row, column) }}
              </td>
            </ng-container>
          }

          @if (config().showActions && config().actions) {
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef style="width: 150px; text-align: center;">
                Actions
              </th>
              <td mat-cell *matCellDef="let row" class="actions-cell">
                @for (action of config().actions; track $index) {
                  @if (isActionVisible(row, $index)) {
                    <button 
                      mat-icon-button 
                      [color]="action.color ?? 'primary'"
                      [matTooltip]="action.label"
                      (click)="handleAction(row, $index, $event)">
                      @if (action.icon) {
                        <mat-icon>{{ action.icon }}</mat-icon>
                      } @else {
                        <span>{{ action.label }}</span>
                      }
                    </button>
                  }
                }
              </td>
            </ng-container>
          }

          <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
          
          <tr 
            mat-row 
            *matRowDef="let row; columns: displayedColumns();" 
            [class.clickable]="isClickable()"
            (click)="onRowClick(row)">
          </tr>
        </table>
      </div>

      @if (config().pageable) {
        <mat-paginator 
          [length]="totalItems()"
          [pageSize]="pageSize()"
          [pageSizeOptions]="[5, 10, 25, 50, 100]"
          (page)="handlePageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      }
    }
  }
</div>
